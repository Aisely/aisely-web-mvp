"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.connectClient = exports.socketServer = void 0;
var WebSocket = require("ws");
var uuid_1 = require("uuid");
exports.socketServer = new WebSocket.Server({
    noServer: true,
});
var connectClient = function (_a, db) {
    var request = _a[0], socket = _a[1], head = _a[2];
    var baseURL = 'http://' + request.headers.host + '/';
    var pathname = new URL(request.url, baseURL).pathname;
    if (pathname !== "/" + db) {
        socket.destroy();
    }
    var connectionId = uuid_1.v4();
    exports.socketServer.handleUpgrade(request, socket, head, function (ws) {
        exports.socketServer.emit('connection', ws, { id: connectionId, db: db });
    });
};
exports.connectClient = connectClient;
//# sourceMappingURL=index.js.map